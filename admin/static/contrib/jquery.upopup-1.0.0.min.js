/* uPopup: Source and license at http://github.com/browndav/upopup */
(function(a){a.uPopup={},a.uPopup.z={create:function(b,c){var d=a.uPopup.z.y,e=c||{},f=d.t(b);a(this).each(function(b,c){var g=f[b]||f.last;a.isFunction(g)&&(g=g.call(g,c)),c=a(c),g=a(g);var h=d.wrap(c);c.data("upopup",{elt:h,options:e}),d.insert(h,c,g,e),d.autoposition(h,c,g,e),e.reposition!==!1&&a(window).resize(function(b){a.uPopup.z.y.autoposition(h,c,g,e)})});return this},show:function(){var b=a.uPopup.z.y;a(this).each(function(c,d){var e=b.z(d);a.uPopup.z.y.y.call(d,!0,(e.options||{}).onShow)})},hide:function(b){var c=a.uPopup.z.y;a(this).each(function(b,d){var e=c.z(d);a.uPopup.z.y.y.call(d,!1,(e.options||{}).onHide)})},destroy:function(){a.uPopup.z.y.y.call(this,!1,function(a){a.remove(),delete a})},elements:function(){var b=a.uPopup.z.y;return a(a(this).map(function(a,c){var d=b.z(c).elt;return d?d[0]:!1}).filter(function(a){return!a}))},y:{w:0,v:16384,t:function(b){return a.isArray(b)?b:[b]},z:function(b){return a(b).data("upopup")||{}},s:function(a){var b,c;for(var d=0,e=a.length;d<e;++d)if(!c||a[d]>c)c=a[d],b=d;return b},wrap:function(b,c){var d=c||{},e=a('<div class="upopup"><div class="direction"><div class="arrow first-arrow"/><div class="border"><div class="inner"/></div><div class="arrow last-arrow"/><div class="clear"/></div></div>');a(".inner",e).append(b);return e},insert:function(b,c,d,e){var f=e||{},g=a.uPopup.z.y;b.css("z-index",g.v+g.w++),b.css("display","none"),b.prependTo("body"),a.uPopup.z.show.call(c)},y:function(b,c){var d=a.uPopup.z.y;a(this).each(function(a,e){var f=d.z(e),g=f.options||{},h=f.elt,i=function(){c&&c.call(e,h)};g.fx!==!1?b?h.fadeIn(!1,i):h.fadeOut(!1,i):(b?h.show():h.hide(),i.call(this))});return this},autoposition:function(b,c,d,e){var f={},g=a.uPopup.z.y,h=e||{},i=h.eventData,j=a(document),k=d.offset(),l={x:j.width(),y:j.height()},m={x:d.outerWidth(!0),y:d.outerHeight(!0)};if(i){var n=g.u(i,g.z(c),k,m);f={x:[n.x,l.x-n.x],y:[n.y,l.y-n.y]}}else f={x:[k.left,l.x-k.left-m.x],y:[k.top,l.y-k.top-m.y]};if(h.useViewport!==!1){var o=a(window),p={y:o.scrollTop(),x:o.scrollLeft()};f.x[0]-=p.x,f.x[1]-=l.x-(p.x+o.width()),f.y[0]-=p.y,f.y[1]-=l.y-(p.y+o.height())}var q={x:g.s(f.x),y:g.s(f.y)};return g.reposition(b,c,d,q.x,q.y,e)},reposition:function(b,c,d,e,f,g){var h,i=a.uPopup.z.y,j=g||{},k=j.eventData,l=b.closestChild(".direction"),m=l.closestChild(".arrow"),n=d.offset(),o={x:b.outerWidth(!0),y:b.outerHeight(!0)},p={x:d.outerWidth(!0),y:d.outerHeight(!0)},q={x:(o.x-l.width())/2,y:(o.y-l.height())/2},r={x:m.outerWidth(),y:m.outerHeight()},s=i.x(b),t=j.vertical?[-1,1,0]:[1,0,1];if(k){var u=i.u(k,i.z(c),n,p);h={x:[u.x-o.x-t[0]*r.x/2+t[1]*s.x,u.x+t[0]*r.x/2-t[1]*s.x],y:[u.y-o.y+t[0]*r.y/2+t[2]*s.y,u.y-t[0]*r.y/2-t[2]*s.y]}}else h={x:[n.left-o.x+t[1]*s.x+q.x-t[0]*r.x/2,n.left+p.x-t[1]*s.x-q.x+t[0]*r.x/2],y:[n.top-o.y+t[2]*s.y+q.y+t[0]*r.y/2,n.top+p.y-t[2]*s.y-q.y-t[0]*r.y/2]};if(!j.eventData){if(j.center||j.centerX){var v=p.x/2;h.x[0]+=v,h.x[1]-=v}if(j.center||j.centerY){var w=p.y/2;h.y[0]+=w,h.y[1]-=w}}var x=j.vertical?[["se","ne"],["s","n"]]:[["ese","e"],["wsw","w"]];l.removeClass("se ne s n ese e wsw w"),l.addClass(x[e][f]),b.offset({top:h.y[f],left:h.x[e]})},x:function(b){var c=a("<div/>").addClass("adjust");b.append(c);var d={x:c.width(),y:c.height()};c.remove();return d},u:function(a,b,c,d){var e=a.pageX,f=a.pageY;b.r&&(e=c.left+b.r.x*d.x,f=c.top+b.r.y*d.y),b.r||(b.r={x:(e-c.left)/d.x,y:(f-c.top)/d.y});return{x:e,y:f}}}},a.fn.uPopup=function(b){return a.uPopup.z[b].apply(this,Array.prototype.slice.call(arguments,1))}})($),function(a){a.fn.closestChild||(a.fn.closestChild=function(b){if(b&&b!==""){var c=[];c.push(this);while(c.length>0){var d=c.shift(),e=d.children();for(var f=0;f<e.length;++f){var g=a(e[f]);if(g.is(b))return g;c.push(g)}}}return a()})}($);
